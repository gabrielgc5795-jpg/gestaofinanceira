<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Gestão Financeira</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Header Profissional -->
  <header class="main-header">
    <div class="header-content">
      <div class="logo-section">
        <a class="logo" href="index.html" title="Ir para a tela inicial">
          <i class="fas fa-chart-line"></i>
          <span>Gestão Financeira</span>
        </a>
        <p class="tagline">Sistema completo de gestão</p>
      </div>
      <div class="header-stats">
        <div class="stat-item">
          <span class="stat-label">Saldo Atual</span>
          <span class="stat-value" id="header-saldo">R$ 0,00</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Transações</span>
          <span class="stat-value" id="header-transacoes">0</span>
        </div>
        <div class="theme-toggle">
          <button onclick="toggleTheme()" class="theme-btn">
            <i class="fas fa-moon"></i>
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Navegação das Abas -->
  <nav class="tab-navigation">
    <button class="tab-button active" onclick="navegarPara('dashboard')">
      <i class="fas fa-tachometer-alt"></i>
      <span>Dashboard</span>
    </button>
    <button class="tab-button" onclick="navegarPara('transacoes')">
      <i class="fas fa-list"></i>
      <span>Transações</span>
    </button>
    <button class="tab-button" onclick="navegarPara('graficos')">
      <i class="fas fa-chart-bar"></i>
      <span>Gráficos</span>
    </button>
    <button class="tab-button" onclick="navegarPara('relatorios')">
      <i class="fas fa-file-alt"></i>
      <span>Relatórios</span>
    </button>
    <button class="tab-button" onclick="navegarPara('orcamento')">
      <i class="fas fa-wallet"></i>
      <span>Orçamento</span>
    </button>
    <button class="tab-button" onclick="navegarPara('metas')">
      <i class="fas fa-bullseye"></i>
      <span>Metas</span>
    </button>
    <button class="tab-button" onclick="navegarPara('notas-fiscais')">
      <i class="fas fa-receipt"></i>
      <span>Notas Fiscais</span>
    </button>
    <button class="tab-button" onclick="navegarPara('configuracoes')">
      <i class="fas fa-cog"></i>
      <span>Configurações</span>
    </button>
  </nav>

  <!-- Conteúdo do Dashboard -->
  <main class="main-content">
    <!-- Cards de Resumo -->
    <div class="dashboard-cards">
      <div class="summary-card balance-card">
        <div class="card-header">
          <i class="fas fa-wallet"></i>
          <h3>Saldo Atual</h3>
        </div>
        <div class="card-content">
          <span class="balance-value" id="valor-saldo">R$ 0,00</span>
          <div class="balance-trend">
            <i class="fas fa-arrow-up"></i>
            <span>+5.2% este mês</span>
          </div>
        </div>
      </div>

      <div class="summary-card income-card">
        <div class="card-header">
          <i class="fas fa-arrow-up"></i>
          <h3>Receitas</h3>
        </div>
        <div class="card-content">
          <span class="card-value" id="total-receitas">R$ 0,00</span>
          <div class="card-subtitle">Este mês</div>
        </div>
      </div>

      <div class="summary-card expense-card">
        <div class="card-header">
          <i class="fas fa-arrow-down"></i>
          <h3>Despesas</h3>
        </div>
        <div class="card-content">
          <span class="card-value" id="total-despesas">R$ 0,00</span>
          <div class="card-subtitle">Este mês</div>
        </div>
      </div>

      <div class="summary-card transaction-card">
        <div class="card-header">
          <i class="fas fa-list"></i>
          <h3>Transações</h3>
        </div>
        <div class="card-content">
          <span class="card-value" id="total-transacoes-dash">0</span>
          <div class="card-subtitle">Total registradas</div>
        </div>
      </div>
    </div>

    <!-- Formulário de Nova Transação -->
    <div class="form-card">
      <div class="card-header">
        <i class="fas fa-plus-circle"></i>
        <h3>Nova Transação</h3>
      </div>
      <form id="form-transacao" class="modern-form">
        <div class="form-row">
          <div class="form-field">
            <label for="descricao">
              <i class="fas fa-edit"></i>
              Descrição
            </label>
            <input type="text" id="descricao" name="descricao" placeholder="Ex: Salário, Almoço, Gasolina..." required>
          </div>
          <div class="form-field">
            <label for="valor">
              <i class="fas fa-dollar-sign"></i>
              Valor
            </label>
            <input type="number" id="valor" name="valor" placeholder="0,00" step="0.01" required>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-field">
            <label for="categoria">
              <i class="fas fa-tags"></i>
              Categoria
            </label>
            <select id="categoria" name="categoria" required>
              <option value="">Selecione uma categoria</option>
              <option value="alimentacao">🍽️ Alimentação</option>
              <option value="transporte">🚗 Transporte</option>
              <option value="lazer">🎮 Lazer</option>
              <option value="saude">🏥 Saúde</option>
              <option value="educacao">📚 Educação</option>
              <option value="vestuario">👕 Vestuário</option>
              <option value="casa">🏠 Casa</option>
              <option value="investimentos">📈 Investimentos</option>
              <option value="salario">💰 Salário</option>
              <option value="freelance">💼 Freelance</option>
              <option value="outros">📦 Outros</option>
            </select>
          </div>
          <div class="form-field">
            <label for="tipo">
              <i class="fas fa-exchange-alt"></i>
              Tipo
            </label>
            <select id="tipo" name="tipo" required>
              <option value="">Selecione o tipo</option>
              <option value="receita">💰 Receita</option>
              <option value="despesa">💸 Despesa</option>
            </select>
          </div>
        </div>
        
        <button type="submit" class="submit-btn">
          <span class="btn-text">
            <i class="fas fa-plus"></i>
            Adicionar Transação
          </span>
        </button>
      </form>
    </div>
  </main>

  <!-- Sistemas Profissionais -->
  <script src="validation.js"></script>
  <script src="notifications.js"></script>
  <script src="loading-system.js"></script>
  <script src="confirmation-system.js"></script>
  <script src="backup-system.js"></script>
  <script src="analytics-system.js"></script>
  
  <!-- Scripts do Sistema -->
  <script src="daTA.js"></script>
  <script src="common.js"></script>
  <script src="metas.js"></script>
  <script>
    // Função específica do dashboard
    function atualizarDashboard() {
      const stats = calcularEstatisticas();
      
      // Atualizar cards do dashboard
      document.getElementById("valor-saldo").textContent = `R$ ${stats.saldo.toFixed(2)}`;
      document.getElementById("total-receitas").textContent = `R$ ${stats.receitas.toFixed(2)}`;
      document.getElementById("total-despesas").textContent = `R$ ${stats.despesas.toFixed(2)}`;
      document.getElementById("total-transacoes-dash").textContent = stats.totalTransacoes;
      
      // Atualizar header
      atualizarHeader();
    }

    // Configuração de validação para o formulário
    const formValidationRules = {
      descricao: [
        { validator: 'required', message: 'Descrição é obrigatória' },
        { validator: 'min_length', params: [3], message: 'Descrição deve ter pelo menos 3 caracteres' }
      ],
      valor: [
        { validator: 'required', message: 'Valor é obrigatório' },
        { validator: 'number', message: 'Digite um valor numérico válido' },
        { validator: 'positive', message: 'Valor deve ser maior que zero' }
      ],
      tipo: [
        { validator: 'required', message: 'Selecione o tipo da transação' }
      ],
      categoria: [
        { validator: 'required', message: 'Selecione uma categoria' }
      ]
    };

    // Event listener para formulário de transação
    document.addEventListener('DOMContentLoaded', function() {
      // Configura validação do formulário
      setupFormValidation('#form-transacao', formValidationRules, {
        onSubmit: async function(form) {
          const formData = new FormData(form);
          const descricao = formData.get('descricao');
          const valor = parseFloat(formData.get('valor'));
          const tipo = formData.get('tipo');
          const categoria = formData.get('categoria');

          try {
            // Simula operação assíncrona com loading
            await withLoading(async () => {
              // Simula delay de rede
              await new Promise(resolve => setTimeout(resolve, 800));
              
              adicionarTransacao(descricao, valor, tipo, categoria);
              atualizarDashboard();
            }, {
              button: form.querySelector('.submit-btn'),
              title: 'Salvando transação...',
              message: 'Processando dados'
            });

            // Mostra notificação de sucesso
            showSuccess(
              'Transação Adicionada!', 
              `${tipo === 'receita' ? 'Receita' : 'Despesa'} de R$ ${valor.toFixed(2)} foi registrada com sucesso.`
            );

            // Limpa o formulário
            form.reset();
            
            // Remove estados de validação
            form.querySelectorAll('.form-field').forEach(field => {
              field.classList.remove('success', 'error');
              const messages = field.querySelectorAll('.error-message, .success-message');
              messages.forEach(msg => msg.remove());
            });

          } catch (error) {
            showError('Erro ao Salvar', 'Ocorreu um erro ao salvar a transação. Tente novamente.');
          }
        }
      });
      
      // Atualizar dashboard inicial
      atualizarDashboard();
      
      // Mostra notificação de boas-vindas
      setTimeout(() => {
        showInfo('Dashboard Carregado', 'Sistema pronto para uso!', { duration: 3000 });
      }, 500);
    });
  </script>
</body>
</html>
